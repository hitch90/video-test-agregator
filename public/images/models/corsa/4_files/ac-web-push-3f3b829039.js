$(function(){var e="BBzhprQr14nicktdHBpd/HUT4eYJxRGwUZpP/mtwuPKxkNTZpWtFSdSeWY9a+qdHgyr/Q5aNS7UlZV88iF/lrZs=",n=$(".web-push-box");function t(n){navigator.serviceWorker.ready.then(function(n){return n.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:function(e){for(var n="=".repeat((4-e.length%4)%4),t=(e+n).replace(/\-/g,"+").replace(/_/g,"/"),i=window.atob(t),r=new Uint8Array(i.length),o=0;o<i.length;++o)r[o]=i.charCodeAt(o);return r}(e)})}).then(function(e){i(e,"POST",function(){o(),n&&function(e){if(!e)return;var n=e.getKey("p256dh"),t=e.getKey("auth");$.ajax({type:"POST",url:"/ac-ajax/push-send-register-notification",data:{endpoint:e.endpoint,key:r(n),token:r(t)},dataType:"json"})}(e)})}).catch(function(){o()})}function i(e,n,t){var i=e.getKey("p256dh"),a=e.getKey("auth");$.ajax({type:"POST",url:"/ac-ajax/push-add-subscription",data:{method:n,endpoint:e.endpoint,key:r(i),token:r(a)},dataType:"json"}).done(function(e){var n;n={id:e.endpointId,key:r(i),token:r(a)},localStorage.setItem("acWebPush",JSON.stringify(n)),t&&t()}).fail(function(){o()})}function r(e){return null===e?null:btoa(String.fromCharCode.apply(null,new Uint8Array(e)))}function o(){n.hide()}n.length<1||($(".web-push-button-no").click(function(){$.cookie("ac_push_disabled","1",{expires:30,path:"/"}),o()}),$.cookie("ac_push_disabled")?o():($(".web-push-button-yes").click(function(){t(!0),o()}),"serviceWorker"in navigator&&"PushManager"in window&&"showNotification"in ServiceWorkerRegistration.prototype&&"denied"!==Notification.permission&&navigator.serviceWorker.register("/ac-web-push-service-worker.js?v=200").then(function(){navigator.serviceWorker.ready.then(function(e){return e.pushManager.getSubscription()}).then(function(e){var o,a,c,u,s;e?(a=(o=e).getKey("p256dh"),c=o.getKey("auth"),s=localStorage.getItem("acWebPush"),(null===(u=s=s&&JSON.parse(s))||u.key!==r(a)||u.token!==r(c))&&i(e,"PUT")):"granted"===Notification.permission?t(!1):setTimeout(function(){n.show()},3e3)})},function(e){console.error("[wp] Service worker registration failed",e)})))});